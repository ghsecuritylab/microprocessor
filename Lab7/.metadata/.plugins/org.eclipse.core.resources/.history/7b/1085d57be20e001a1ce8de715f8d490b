#include "stm32l476xx.h"

extern void gpio_init();
void SystemClock_Config();
void SysTick_Handler();

void led_init(){
	GPIOA->MODER&=0xFFFFFFFC;
	GPIOA->MODER|=0x1;
	GPIOA->PUPDR&=0xFFFFFFFC;
	GPIOA->PUPDR|=0x1;
	GPIOA->ODR&=0xFFFFFFFE;
}

int main()
{
	RCC->AHB2ENR = 0b1;
	RCC->APB2ENR = 0b1;
	SystemClock_Config();
	led_init();
	while (1);
}

void SystemClock_Config()
{
	RCC->CR |= 0x100; //turn on HSI16
	RCC->CFGR |= 0x01; //for hsi16
	RCC->CFGR |= 0x80; //for prescaler 2，原本16就會除以8，再設成2就變成一百萬cycle
	SysTick->CTRL |= 2;
	SysTick->LOAD = 3 * 1000000;
	SysTick->VAL = 0;
	SysTick->CTRL |= 3;
}

void SysTick_Handler()
{
	GPIOA->ODR ^= 1;
}
